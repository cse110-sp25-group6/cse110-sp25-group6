<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>pullpage/pack.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="CardComponent.html">CardComponent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardComponent.html#connectedCallback">connectedCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardComponent.html#render">render</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="CardInspector.html">CardInspector</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardInspector.html#connectedCallback">connectedCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardInspector.html#defineEventListeners">defineEventListeners</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardInspector.html#displayCurrentCard">displayCurrentCard</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardInspector.html#hide">hide</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardInspector.html#next">next</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardInspector.html#prev">prev</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardInspector.html#render">render</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardInspector.html#show">show</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TopBar.html">TopBar</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TopBar.html#connectedCallback">connectedCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TopBar.html#render">render</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addCardsToDocument">addCardsToDocument</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addCardToCollection">addCardToCollection</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addCurrencyToDocument">addCurrencyToDocument</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createCard">createCard</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createDefaultUser">createDefaultUser</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createPopup">createPopup</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#dealCards">dealCards</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#fillUserProfile">fillUserProfile</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#flipAll">flipAll</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#flipCard">flipCard</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getCollectionCards">getCollectionCards</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getRandomCard">getRandomCard</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#init">init</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#makeAPull">makeAPull</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#resetPackUnlockTimer">resetPackUnlockTimer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#showNotice">showNotice</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#showVideo">showVideo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#sortCards">sortCards</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#styles">styles</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#template">template</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateLocalStorage">updateLocalStorage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updatePackTimeLeft">updatePackTimeLeft</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#verifyPullCount">verifyPullCount</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#wipeCards">wipeCards</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">pullpage/pack.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * This file initializes the pack opening page by loading the card-pack image,
 * setting up event listeners for pulling, generating a pop-up that allows
 * pulling with gems if the user can't affordd packs, and playing the pull
 * animation along with navigating the user to the results page after opening
 * a pack.
 * Dependencies:
 *  - cardComponent.js
 *  - top-bar.js
 */

import "../components/card/cardComponent.js";
import "../components/top-bar/top-bar.js";

window.addEventListener("DOMContentLoaded", init);

const gemsPerPack = 15;

/**
 * Initializes the pack opening functionality by:
 * - Loading and displaying current currency values (gems and packs)
 * - Setting up event listeners for pack opening buttons
 * - Verifying available pack counts for UI feedback
 *  @async
 * @returns {Promise&lt;void>}
 */
function init() {
  //Adds currency values to display in top right, along with altering color of pull buttons if user can't afford to pull.
  addCurrencyToDocument();
  verifyPullCount();

  const packsValue = localStorage.getItem("Packs");
  let pull1 = document.getElementsByClassName("pull1")[0];
  if (pull1) {
    pull1.addEventListener("click", () => {
      if (packsValue &lt; 1) {
        createPopup(1);
      } else {
        makeAPull(1);
      }
    });
  }

  //Event listener for single-pull button. Makes a single-pull for 5 cards if user can afford to pull, generates a pop-up otherwise.
  document.getElementsByClassName("pull1")[0].addEventListener("click", () => {
    if (packsValue &lt; 1) {
      createPopup(1);
    } else {
      makeAPull(1);
    }
  });

  //Event listener for five-pull button. Makes a five-pull for 25 cards if user can afford to pull, generates a pop-up otherwise.
  document.getElementsByClassName("pull5")[0].addEventListener("click", () => {
    if (packsValue &lt; 5) {
      createPopup(5);
    } else {
      makeAPull(5);
    }
  });
}

/**
 * Updates the displayed currency values (gems and packs) from local storage
 * @returns {void}
 */
export function addCurrencyToDocument() {
  const gems = document.getElementsByClassName("gems");
  const packs = document.getElementsByClassName("packs");

  //Retrives currency values from local storage.
  let gemsValue = localStorage.getItem("Gems");
  let packsValue = localStorage.getItem("Packs");

  //temporary setting test values for dev purposes
  let setBudget = true;
  if (setBudget) {
    gemsValue = 999999;
    packsValue = 100;
    localStorage.setItem("Gems", JSON.stringify(gemsValue));
    localStorage.setItem("Packs", JSON.stringify(packsValue));
  }

  //Update display in top right with appriopriate values
  for (let i = 0; i &lt; gems.length; i++) {
    gems[i].innerHTML = `Gems: ${gemsValue}`;
  }
  for (let i = 0; i &lt; packs.length; i++) {
    packs[i].innerHTML = `Packs: ${packsValue}`;
  }
}

/**
 * Verifies if there are enough packs for pulls and updates button states
 * @returns {void}
 */
function verifyPullCount() {
  const pull1 = document.getElementsByClassName("pull1");
  const pull5 = document.getElementsByClassName("pull5");

  const packsValue = localStorage.getItem("Packs");

  //Updates class of "Pull 1" button if user can't afford a single-pull.
  for (let i = 0; i &lt; pull1.length; i++) {
    pull1[i].classList.toggle("not-enough-packs", packsValue &lt; 1);
  }

  //Updates class of "Pull 1" button if user can't afford a five-pull.
  for (let i = 0; i &lt; pull5.length; i++) {
    pull5[i].classList.toggle("not-enough-packs", packsValue &lt; 5);
  }
}

/**
 * Creates a popup dialog when user doesn't have enough packs. Popup
 * allows pulling by spending gems if user can afford the gem-cost.
 * @param {number} pullCount - Number of packs the user wants to open
 * @returns {void}
 */
function createPopup(pullCount) {
  // Initializes variables used to handle dynamic logic.
  const gemCount = localStorage.getItem("Gems");
  //Plural is used to fix grammatical errors for single vs five pulls.
  const plural = pullCount > 1;
  const pullCost = pullCount * gemsPerPack;
  const enoughGems = gemCount > pullCost;

  //Generates popup container that fills entire page and hosts the pop-up.
  const mainContainer = document.querySelector("main");
  const popupContainer = document.createElement("div");
  popupContainer.classList.add("popup-container");

  //Generates actual popup element to host the subsections of the pop-up.
  const popup = document.createElement("div");
  popup.classList.add("popup");

  //Generates popup text container that hosts the text for the pop-up
  const popupTextContainer = document.createElement("div");
  popupTextContainer.classList.add("popup-text-container");

  //Generates popup text, which will notify the user that they can not afford the pull using packs.
  //Uses template literals to have dynamic text, depending on if they can afford to pull using gems.
  const popupText = document.createElement("div");
  popupText.classList.add("popup-text");
  popupText.innerHTML = `An Additional &lt;span class="yellow">${pullCount}&lt;/span> pack ${plural ? "s are needed." : "is needed."} &lt;br> Purchase with &lt;span class=${enoughGems ? "yellow" : "red"}>${pullCost}&lt;/span> gems?&lt;br>&lt;br> ${enoughGems ? "" : "&lt;span class='red'>Insufficient Funds&lt;/span>"} `;

  popupTextContainer.append(popupText);

  //Generates container for the two pop-up buttons
  const popupButtonContainer = document.createElement("div");
  popupButtonContainer.classList.add("popup-button-container");

  //Generates cancel button to exit pop-up
  const popupCancel = document.createElement("button");
  popupCancel.classList.add("popup-button");
  popupCancel.innerText = "Cancel";

  //Generates confirm button to allow user to pull using gems
  const popupConfirm = document.createElement("button");
  popupConfirm.classList.add("popup-button");
  //Prevents user from pulling using gems if they are unable to afford the gem-cost.
  if (!enoughGems) {
    popupConfirm.disabled = true;
  }
  popupConfirm.innerText = "Confirm";

  //Appends containers and other DOM elements for appropriate nesting.
  popupButtonContainer.append(popupCancel);
  popupButtonContainer.append(popupConfirm);

  popup.append(popupTextContainer);
  popup.append(popupButtonContainer);

  popupContainer.append(popup);

  mainContainer.append(popupContainer);

  //Adds event listener for the "confirm" button, which makes a pull.
  popupConfirm.addEventListener("click", () => {
    popupContainer.remove();
    makeAPull(pullCount, true);
  });

  //Addds event listener for the "cancel" button, which closes the pop-up.
  popupCancel.addEventListener("click", () => {
    popupContainer.remove();
  });

  //Adds event listener to allow user to click outside the pop-up to close the pop-up.
  popupContainer.addEventListener("click", (e) => {
    if (!popup.contains(e.target)) {
      popupContainer.remove();
    }
  });
}

/**
 * Handles the logic for opening card packs
 * @param {number} pullCount - Number of packs to open
 * @param {boolean} gemPull - Whether the pull is paid with gems
 * @returns {void}
 */
function makeAPull(pullCount, gemPull) {
  let gemsValue = localStorage.getItem("Gems");
  let packsValue = localStorage.getItem("Packs");
  //Decrements gems or packs value (depending on the type of currency spent) and updates local storage to match.
  if (gemPull) {
    gemsValue -= gemsPerPack * pullCount;
    localStorage.setItem("Gems", JSON.stringify(gemsValue));
  } else {
    packsValue -= pullCount;
    localStorage.setItem("Packs", JSON.stringify(packsValue));
  }
  //Updates session storage with values needed for results logic.
  sessionStorage.setItem("madePull", "true");
  sessionStorage.setItem("pull5", pullCount == 5);
  //Plays pull animation.
  showVideo(pullCount);
}

/**
 * Displays the pack opening animation video and handles transition to results page
 * @returns {void}
 */
function showVideo(pullCount) {
  const videoContainer = document.getElementsByClassName("video-container");
  const videoElement = document.getElementsByClassName("pack-video");

  //Makes video container visible
  for (let i = 0; i &lt; videoContainer.length; i++) {
    videoContainer[i].classList.toggle("show", true);
  }

  if (pullCount == 5) {
    videoElement[0].src = "pull5Video.mp4";
  } else {
    videoElement[0].src = "pull1Video.mp4";
  }

  //Makes the video itself display, then plays the video
  for (let i = 0; i &lt; videoElement.length; i++) {
    videoElement[i].style.display = "unset";
    videoElement[i].play();
  }

  //Adds event listener to wait until the video finishes playing, before redirecting user to the pack results page.
  videoElement[0].addEventListener("ended", () => {
    // switch to results page
    window.location.href = "results.html";
  });
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Mon Jun 09 2025 05:18:29 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
