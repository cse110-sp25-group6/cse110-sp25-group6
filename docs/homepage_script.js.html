<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>homepage/script.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="CardComponent.html">CardComponent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardComponent.html#connectedCallback">connectedCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardComponent.html#render">render</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="CardInspector.html">CardInspector</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardInspector.html#connectedCallback">connectedCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardInspector.html#defineEventListeners">defineEventListeners</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardInspector.html#displayCurrentCard">displayCurrentCard</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardInspector.html#hide">hide</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardInspector.html#next">next</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardInspector.html#prev">prev</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardInspector.html#render">render</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardInspector.html#show">show</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TopBar.html">TopBar</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TopBar.html#connectedCallback">connectedCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TopBar.html#render">render</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addCardsToDocument">addCardsToDocument</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addCardToCollection">addCardToCollection</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addCurrencyToDocument">addCurrencyToDocument</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createCard">createCard</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createDefaultUser">createDefaultUser</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createPopup">createPopup</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#dealCards">dealCards</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#fillUserProfile">fillUserProfile</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#flipAll">flipAll</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#flipCard">flipCard</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getCollectionCards">getCollectionCards</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getRandomCard">getRandomCard</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#init">init</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#makeAPull">makeAPull</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#resetPackUnlockTimer">resetPackUnlockTimer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#showNotice">showNotice</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#showVideo">showVideo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#sortCards">sortCards</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#styles">styles</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#template">template</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateLocalStorage">updateLocalStorage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updatePackTimeLeft">updatePackTimeLeft</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#verifyPullCount">verifyPullCount</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#wipeCards">wipeCards</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">homepage/script.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// ---------- On page load: Main UI logic ----------
document.addEventListener("DOMContentLoaded", () => {
  // [1] Load or initialize user data from localStorage
  updateLocalStorage();

  // [2] Fill profile &amp; stats fields with loaded user data
  fillUserProfile();

  // [4] Register Account Modal: handle open, close, register, enter key, click outside
  const modal = document.getElementById("modalOverlay");
  const openModalBtn = document.getElementById("registerBtn");
  const closeModalBtn = document.getElementById("closeModalBtn");
  const confirmRegisterBtn = document.getElementById("confirmRegisterBtn");
  const newUsernameInput = document.getElementById("newUsername");

  // Open modal
  openModalBtn?.addEventListener("click", () => {
    modal.style.display = "flex";
    newUsernameInput.value = "";
    newUsernameInput.focus();
  });

  // Close modal (ESC button)
  closeModalBtn?.addEventListener("click", () => {
    modal.style.display = "none";
  });

  // Confirm registration
  confirmRegisterBtn?.addEventListener("click", () => {
    const username = newUsernameInput.value.trim();
    if (!username) {
      alert("Please enter a username!");
      newUsernameInput.focus();
      return;
    }
    const newAccount = createDefaultUser(username);
    // localStorage.setItem("Username", JSON.stringify(newAccount));
    localStorage.clear(); // resets Local Storage for new user
    updateLocalStorage(newAccount);
    modal.style.display = "none";
    fillUserProfile();
    location.reload(); // Sync UI
  });

  // Enter key submits
  newUsernameInput?.addEventListener("keydown", (e) => {
    if (e.key === "Enter") confirmRegisterBtn.click();
  });

  // Click outside modal to close
  modal.addEventListener("click", (e) => {
    if (e.target === modal) modal.style.display = "none";
  });

  // [5] Start unlock countdown timer
  setInterval(updatePackTimeLeft, 1000);
  updatePackTimeLeft();
});

// ESC closes registration modal
document.addEventListener("keydown", (e) => {
  const modal = document.getElementById("modalOverlay");
  if (e.key === "Escape" &amp;&amp; modal.style.display === "flex") {
    modal.style.display = "none";
  }
});

/**
 * Utility: Display a temporary notice/toast
 * @param {string} msg - Message to display
 */
function showNotice(msg) {
  const notice = document.getElementById("customNotice");
  const text = document.getElementById("customNoticeText");
  text.textContent = msg;
  notice.style.display = "block";
  setTimeout(() => {
    notice.style.display = "none";
  }, 2000);
}

/**
 * Utility: Create a default (new or guest) user data object
 * @param {string} username - Name for the user
 * @returns {object} New user data
 */
function createDefaultUser(username = "guest") {
  return {
    Username: username,
    AccountCreateTime: new Date().toISOString(),
    UsrLvl: 1,
    LevelProgress: 0,
    Gems: 100,
    Packs: 3,
    PackProgress: 0,
    PacksOpened: 0,
    Collection: [],
    Misc: {},
    nextPackUnlockTime: Date.now() + 5 * 60 * 1000, // 5 minutes
  };
}

/**
 * Checks local storage to make sure that all data is present and populates if empty
 * @param {object} user - object containing all user data
 */
function updateLocalStorage(user = createDefaultUser()) {
  let data = [
    "Username",
    "AccountCreateTime",
    "UsrLvl",
    "LevelProgress",
    "Gems",
    "Packs",
    "PackProgress",
    "PacksOpened",
    "Collection",
    "nextPackUnlockTime",
    "Misc",
  ];
  data.forEach((element) => {
    // checks all fields
    let item = localStorage.getItem(element);
    if (!item) {
      // populates if item does not exist in the local storage
      localStorage.setItem(element, user[element]);
    }
  });
}

/**
 * Utility: Fill all profile/pack info from userData object
 */
function fillUserProfile() {
  // Avatar: Show uppercase initials
  const initials = localStorage.getItem("Username")
    ? localStorage.getItem("Username").match(/[A-Z]/g)?.join("") ||
      localStorage.getItem("Username")[0].toUpperCase()
    : "U";
  document.querySelector(".avatar").textContent = initials;

  // Fill user fields
  document.getElementById("profileName").textContent =
    localStorage.getItem("Username") || "Guest";
  document.getElementById("userLevel").textContent =
    `Level ${localStorage.getItem("Usrlvl") || 1}`;
  document.getElementById("levelProgress").value =
    localStorage.getItem("LevelProgress") || 0;
  document.getElementById("levelProgressLabel").textContent =
    `${localStorage.getItem("LevelProgress") || 0}%`;
  document.getElementById("headerGemsCount").textContent =
    localStorage.getItem("Gems") || 0;
  document.getElementById("headerPacksCount").textContent =
    localStorage.getItem("Packs") || 0;
  document.getElementById("currentPacks").textContent =
    localStorage.getItem("Packs") || 0;
  // Progress and time are auto-updated by updatePackTimeLeft()
}

/**
 * Countdown timer for next pack unlock
 * Updates progress bar &amp; time label, enables pack opening if time is up.
 */
function updatePackTimeLeft() {
  // makes sure local storage is populated
  updateLocalStorage();

  const unlockTime = Number(localStorage.getItem("nextPackUnlockTime"));
  const now = Date.now();
  const totalMs = 5 * 60 * 1000; // 5 minutes
  const msLeft = Math.max(0, unlockTime - now);

  // Progress bar
  const elapsed = totalMs - msLeft;
  const percent = Math.min(100, Math.round((elapsed / totalMs) * 100));
  document.getElementById("packProgress").value = percent;
  document.getElementById("packProgressLabel").textContent = `${percent}%`;

  // Time label and pack increment
  if (msLeft &lt;= 0) {
    // Give a new pack and reset timer
    localStorage.setItem(
      "Packs",
      (parseInt(localStorage.getItem("Packs")) || 0) + 1,
    );
    localStorage.setItem("nextPackUnlockTime", Date.now() + 5 * 60 * 1000); // reset for another 5 minutes
    fillUserProfile();

    document.getElementById("packTimeLeft").textContent = "Ready!";
    document.getElementById("packProgress").value = 100;
    document.getElementById("packProgressLabel").textContent = "100%";
  } else {
    const mins = Math.floor(msLeft / 60000);
    const secs = Math.floor((msLeft % 60000) / 1000);
    document.getElementById("packTimeLeft").textContent =
      `${mins}min ${secs}sec left until the next pack!`;
  }
}

/**
 * Call this after a pack is opened to reset the unlock timer.
 */
function resetPackUnlockTimer() {
  let nextPackUnlockTime = Date.now() + 5 * 60 * 1000; // 5 minutes
  localStorage.setItem("nextPackUnlockTime", nextPackUnlockTime);
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Mon Jun 09 2025 06:02:34 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
